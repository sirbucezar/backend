import{r as b,j as $,o as qe}from"./react-CmEzmXpT.js";import{L as Ee,R as At,U as kt,a as Dt,O as ke,P as De,S as Ft,b as Se,N as Ht,A as It,V as U,c as st,W as Bt,C as Wt,B as $t,d as Nt,e as Gt,f as qt,T as Vt,D as Ut,g as he,h as Xt,i as Ve,H as Yt,j as Zt,F as Kt}from"./three-B6NbTccM.js";import{c as Ue}from"./debounce-D1lbXHVv.js";import{F as Jt,u as Qt}from"./its-fine-BSQV0PKa.js";import{R as en,c as le}from"./react-reconciler-BrIjypLO.js";import{s as Xe}from"./scheduler-D0oS9gf5.js";import{_ as at}from"./@babel-CF3RwP-h.js";import{c as tn}from"./react-dom-DXFLI2Zf.js";import"./maath-B301nOMh.js";import{G as Fe,D as nn,M as xe}from"./three-stdlib-DjzL-lb7.js";import{c as rn}from"./zustand-C-t82aId.js";import{s as on,p as sn,c as an}from"./suspend-react-BKIKQNXN.js";const He={},cn=e=>void Object.assign(He,e);function ln(e,t){function r(n,{args:o=[],attach:u,...f},h){let E=`${n[0].toUpperCase()}${n.slice(1)}`,v;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=f.object;v=te(s,{type:n,root:h,attach:u,primitive:!0})}else{const s=He[E];if(!s)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");v=te(new s(...o),{type:n,root:h,attach:u,memoizedProps:{args:o}})}return v.__r3f.attach===void 0&&(v.isBufferGeometry?v.__r3f.attach="geometry":v.isMaterial&&(v.__r3f.attach="material")),E!=="inject"&&_e(v,f),v}function i(n,o){let u=!1;if(o){var f,h;(f=o.__r3f)!=null&&f.attach?Pe(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),u=!0),u||(h=n.__r3f)==null||h.objects.push(o),o.__r3f||te(o,{}),o.__r3f.parent=n,ze(o),ne(o)}}function a(n,o,u){let f=!1;if(o){var h,E;if((h=o.__r3f)!=null&&h.attach)Pe(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:o});const v=n.children.filter(d=>d!==o),s=v.indexOf(u);n.children=[...v.slice(0,s),o,...v.slice(s)],f=!0}f||(E=n.__r3f)==null||E.objects.push(o),o.__r3f||te(o,{}),o.__r3f.parent=n,ze(o),ne(o)}}function l(n,o,u=!1){n&&[...n].forEach(f=>g(o,f,u))}function g(n,o,u){if(o){var f,h,E;if(o.__r3f&&(o.__r3f.parent=null),(f=n.__r3f)!=null&&f.objects&&(n.__r3f.objects=n.__r3f.objects.filter(x=>x!==o)),(h=o.__r3f)!=null&&h.attach)Qe(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var v;n.remove(o),(v=o.__r3f)!=null&&v.root&&gn(ye(o),o)}const d=(E=o.__r3f)==null?void 0:E.primitive,y=!d&&(u===void 0?o.dispose!==null:u);if(!d){var s;l((s=o.__r3f)==null?void 0:s.objects,o,y),l(o.children,o,y)}if(delete o.__r3f,y&&o.dispose&&o.type!=="Scene"){const x=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Xe.unstable_scheduleCallback(Xe.unstable_IdlePriority,x):x()}ne(n)}}function c(n,o,u,f){var h;const E=(h=n.__r3f)==null?void 0:h.parent;if(!E)return;const v=r(o,u,n.__r3f.root);if(n.children){for(const s of n.children)s.__r3f&&i(v,s);n.children=n.children.filter(s=>!s.__r3f)}n.__r3f.objects.forEach(s=>i(v,s)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||g(E,n),v.parent&&(v.__r3f.autoRemovedBeforeAppend=!0),i(E,v),v.raycast&&v.__r3f.eventCount&&ye(v).getState().internal.interaction.push(v),[f,f.alternate].forEach(s=>{s!==null&&(s.stateNode=v,s.ref&&(typeof s.ref=="function"?s.ref(v):s.ref.current=v))})}const p=()=>{};return{reconciler:en({createInstance:r,removeChild:g,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const u=n.getState().scene;u.__r3f&&(u.__r3f.root=n,i(u,o))},removeChildFromContainer:(n,o)=>{o&&g(n.getState().scene,o)},insertInContainerBefore:(n,o,u)=>{if(!o||!u)return;const f=n.getState().scene;f.__r3f&&a(f,o,u)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,u,f){var h;if(((h=n==null?void 0:n.__r3f)!=null?h:{}).primitive&&f.object&&f.object!==n)return[!0];{const{args:v=[],children:s,...d}=f,{args:y=[],children:x,...C}=u;if(!Array.isArray(v))throw new Error("R3F: the args prop must be an array!");if(v.some((O,z)=>O!==y[z]))return[!0];const S=ht(n,d,C,!0);return S.changes.length?[!1,S]:null}},commitUpdate(n,[o,u],f,h,E,v){o?c(n,f,E,v):_e(n,u)},commitMount(n,o,u,f){var h;const E=(h=n.__r3f)!=null?h:{};n.raycast&&E.handlers&&E.eventCount&&ye(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>te(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:u,parent:f}=(o=n.__r3f)!=null?o:{};u&&f&&Qe(f,n,u),n.isObject3D&&(n.visible=!1),ne(n)},unhideInstance(n,o){var u;const{attach:f,parent:h}=(u=n.__r3f)!=null?u:{};f&&h&&Pe(h,n,f),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ne(n)},createTextInstance:p,hideTextInstance:p,unhideTextInstance:p,getCurrentEventPriority:()=>t(),beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&L.fun(performance.now)?performance.now:L.fun(Date.now)?Date.now:()=>0,scheduleTimeout:L.fun(setTimeout)?setTimeout:void 0,cancelTimeout:L.fun(clearTimeout)?clearTimeout:void 0}),applyProps:_e}}var Ye,Ze;const Ce=e=>"colorSpace"in e||"outputColorSpace"in e,ct=()=>{var e;return(e=He.ColorManagement)!=null?e:null},lt=e=>e&&e.isOrthographicCamera,un=e=>e&&e.hasOwnProperty("current"),ue=typeof window<"u"&&((Ye=window.document)!=null&&Ye.createElement||((Ze=window.navigator)==null?void 0:Ze.product)==="ReactNative")?b.useLayoutEffect:b.useEffect;function ut(e){const t=b.useRef(e);return ue(()=>void(t.current=e),[e]),t}function fn({set:e}){return ue(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class ft extends b.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}ft.getDerivedStateFromError=()=>({error:!0});const dt="__default",Ke=new Map,dn=e=>e&&!!e.memoized&&!!e.changes;function pt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const se=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function ye(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const L={obj:e=>e===Object(e)&&!L.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(L.str(e)||L.num(e)||L.boo(e))return e===t;const l=L.obj(e);if(l&&i==="reference")return e===t;const g=L.arr(e);if(g&&r==="reference")return e===t;if((g||l)&&e===t)return!0;let c;for(c in e)if(!(c in t))return!1;if(l&&r==="shallow"&&i==="shallow"){for(c in a?t:e)if(!L.equ(e[c],t[c],{strict:a,objects:"reference"}))return!1}else for(c in a?t:e)if(e[c]!==t[c])return!1;if(L.und(c)){if(g&&e.length===0&&t.length===0||l&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function pn(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function hn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function te(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Le(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return r=i.reduce((l,g)=>l[g],e),{target:r,key:a}}else return{target:r,key:t}}const Je=/-\d+$/;function Pe(e,t,r){if(L.str(r)){if(Je.test(r)){const l=r.replace(Je,""),{target:g,key:c}=Le(e,l);Array.isArray(g[c])||(g[c]=[])}const{target:i,key:a}=Le(e,r);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=r(e,t)}function Qe(e,t,r){var i,a;if(L.str(r)){const{target:l,key:g}=Le(e,r),c=t.__r3f.previousAttach;c===void 0?delete l[g]:l[g]=c}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function ht(e,{children:t,key:r,ref:i,...a},{children:l,key:g,ref:c,...p}={},m=!1){const n=e.__r3f,o=Object.entries(a),u=[];if(m){const h=Object.keys(p);for(let E=0;E<h.length;E++)a.hasOwnProperty(h[E])||o.unshift([h[E],dt+"remove"])}o.forEach(([h,E])=>{var v;if((v=e.__r3f)!=null&&v.primitive&&h==="object"||L.equ(E,p[h]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(h))return u.push([h,E,!0,[]]);let s=[];h.includes("-")&&(s=h.split("-")),u.push([h,E,!1,s]);for(const d in a){const y=a[d];d.startsWith(`${h}-`)&&u.push([d,y,!1,d.split("-")])}});const f={...a};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(f.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(f.attach=n.memoizedProps.attach),{memoized:f,changes:u}}function _e(e,t){var r;const i=e.__r3f,a=i==null?void 0:i.root,l=a==null||a.getState==null?void 0:a.getState(),{memoized:g,changes:c}=dn(t)?t:ht(e,t),p=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=g);for(let u=0;u<c.length;u++){let[f,h,E,v]=c[u];if(Ce(e)){const x="srgb",C="srgb-linear";f==="encoding"?(f="colorSpace",h=h===3001?x:C):f==="outputEncoding"&&(f="outputColorSpace",h=h===3001?x:C)}let s=e,d=s[f];if(v.length&&(d=v.reduce((y,x)=>y[x],e),!(d&&d.set))){const[y,...x]=v.reverse();s=x.reverse().reduce((C,S)=>C[S],e),f=y}if(h===dt+"remove")if(s.constructor){let y=Ke.get(s.constructor);y||(y=new s.constructor,Ke.set(s.constructor,y)),h=y[f]}else h=0;if(E&&i)h?i.handlers[f]=h:delete i.handlers[f],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof Ee)){if(Array.isArray(h))d.fromArray?d.fromArray(h):d.set(...h);else if(d.copy&&h&&h.constructor&&d.constructor===h.constructor)d.copy(h);else if(h!==void 0){var m;const y=(m=d)==null?void 0:m.isColor;!y&&d.setScalar?d.setScalar(h):d instanceof Ee&&h instanceof Ee?d.mask=h.mask:d.set(h),!ct()&&l&&!l.linear&&y&&d.convertSRGBToLinear()}}else{var n;if(s[f]=h,(n=s[f])!=null&&n.isTexture&&s[f].format===At&&s[f].type===kt&&l){const y=s[f];Ce(y)&&Ce(l.gl)?y.colorSpace=l.gl.outputColorSpace:y.encoding=l.gl.outputEncoding}}ne(e)}if(i&&i.parent&&e.raycast&&p!==i.eventCount){const u=ye(e).getState().internal,f=u.interaction.indexOf(e);f>-1&&u.interaction.splice(f,1),i.eventCount&&u.interaction.push(e)}return!(c.length===1&&c[0][0]==="onUpdate")&&c.length&&(r=e.__r3f)!=null&&r.parent&&ze(e),e}function ne(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function ze(e){e.onUpdate==null||e.onUpdate(e)}function mn(e,t){e.manual||(lt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function me(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function vn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return le.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return le.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return le.ContinuousEventPriority;default:return le.DefaultEventPriority}}function mt(e,t,r,i){const a=r.get(t);a&&(r.delete(t),r.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function gn(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(a)}),r.capturedMap.forEach((i,a)=>{mt(r.capturedMap,t,i,a)})}function yn(e){function t(p){const{internal:m}=e.getState(),n=p.offsetX-m.initialClick[0],o=p.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(p){return p.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=m.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(p,m){const n=e.getState(),o=new Set,u=[],f=m?m(n.internal.interaction):n.internal.interaction;for(let s=0;s<f.length;s++){const d=se(f[s]);d&&(d.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(p,n);function h(s){const d=se(s);if(!d||!d.events.enabled||d.raycaster.camera===null)return[];if(d.raycaster.camera===void 0){var y;d.events.compute==null||d.events.compute(p,d,(y=d.previousRoot)==null?void 0:y.getState()),d.raycaster.camera===void 0&&(d.raycaster.camera=null)}return d.raycaster.camera?d.raycaster.intersectObject(s,!0):[]}let E=f.flatMap(h).sort((s,d)=>{const y=se(s.object),x=se(d.object);return!y||!x?s.distance-d.distance:x.events.priority-y.events.priority||s.distance-d.distance}).filter(s=>{const d=me(s);return o.has(d)?!1:(o.add(d),!0)});n.events.filter&&(E=n.events.filter(E,n));for(const s of E){let d=s.object;for(;d;){var v;(v=d.__r3f)!=null&&v.eventCount&&u.push({...s,eventObject:d}),d=d.parent}}if("pointerId"in p&&n.internal.capturedMap.has(p.pointerId))for(let s of n.internal.capturedMap.get(p.pointerId).values())o.has(me(s.intersection))||u.push(s.intersection);return u}function a(p,m,n,o){const u=e.getState();if(p.length){const f={stopped:!1};for(const h of p){const E=se(h.object)||u,{raycaster:v,pointer:s,camera:d,internal:y}=E,x=new U(s.x,s.y,0).unproject(d),C=_=>{var w,R;return(w=(R=y.capturedMap.get(_))==null?void 0:R.has(h.eventObject))!=null?w:!1},S=_=>{const w={intersection:h,target:m.target};y.capturedMap.has(_)?y.capturedMap.get(_).set(h.eventObject,w):y.capturedMap.set(_,new Map([[h.eventObject,w]])),m.target.setPointerCapture(_)},O=_=>{const w=y.capturedMap.get(_);w&&mt(y.capturedMap,h.eventObject,w,_)};let z={};for(let _ in m){let w=m[_];typeof w!="function"&&(z[_]=w)}let P={...h,...z,pointer:s,intersections:p,stopped:f.stopped,delta:n,unprojectedPoint:x,ray:v.ray,camera:d,stopPropagation(){const _="pointerId"in m&&y.capturedMap.get(m.pointerId);if((!_||_.has(h.eventObject))&&(P.stopped=f.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(w=>w.eventObject===h.eventObject))){const w=p.slice(0,p.indexOf(h));l([...w,h])}},target:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:O},currentTarget:{hasPointerCapture:C,setPointerCapture:S,releasePointerCapture:O},nativeEvent:m};if(o(P),f.stopped===!0)break}}return p}function l(p){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!p.length||!p.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const u=n.eventObject.__r3f,f=u==null?void 0:u.handlers;if(m.hovered.delete(me(n)),u!=null&&u.eventCount){const h={...n,intersections:p};f.onPointerOut==null||f.onPointerOut(h),f.onPointerLeave==null||f.onPointerLeave(h)}}}function g(p,m){for(let n=0;n<m.length;n++){const o=m[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(p)}}function c(p){switch(p){case"onPointerLeave":case"onPointerCancel":return()=>l([]);case"onLostPointerCapture":return m=>{const{internal:n}=e.getState();"pointerId"in m&&n.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(m.pointerId)&&(n.capturedMap.delete(m.pointerId),l([]))})}}return function(n){const{onPointerMissed:o,internal:u}=e.getState();u.lastEvent.current=n;const f=p==="onPointerMove",h=p==="onClick"||p==="onContextMenu"||p==="onDoubleClick",v=i(n,f?r:void 0),s=h?t(n):0;p==="onPointerDown"&&(u.initialClick=[n.offsetX,n.offsetY],u.initialHits=v.map(y=>y.eventObject)),h&&!v.length&&s<=2&&(g(n,u.interaction),o&&o(n)),f&&l(v);function d(y){const x=y.eventObject,C=x.__r3f,S=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(f){if(S.onPointerOver||S.onPointerEnter||S.onPointerOut||S.onPointerLeave){const O=me(y),z=u.hovered.get(O);z?z.stopped&&y.stopPropagation():(u.hovered.set(O,y),S.onPointerOver==null||S.onPointerOver(y),S.onPointerEnter==null||S.onPointerEnter(y))}S.onPointerMove==null||S.onPointerMove(y)}else{const O=S[p];O?(!h||u.initialHits.includes(x))&&(g(n,u.interaction.filter(z=>!u.initialHits.includes(z))),O(y)):h&&u.initialHits.includes(x)&&g(n,u.interaction.filter(z=>!u.initialHits.includes(z)))}}a(v,n,s,d)}}return{handlePointer:c}}const vt=e=>!!(e!=null&&e.render),gt=b.createContext(null),wn=(e,t)=>{const r=rn((c,p)=>{const m=new U,n=new U,o=new U;function u(s=p().camera,d=n,y=p().size){const{width:x,height:C,top:S,left:O}=y,z=x/C;d.isVector3?o.copy(d):o.set(...d);const P=s.getWorldPosition(m).distanceTo(o);if(lt(s))return{width:x/s.zoom,height:C/s.zoom,top:S,left:O,factor:1,distance:P,aspect:z};{const _=s.fov*Math.PI/180,w=2*Math.tan(_/2)*P,R=w*(x/C);return{width:R,height:w,top:S,left:O,factor:x/R,distance:P,aspect:z}}}let f;const h=s=>c(d=>({performance:{...d.performance,current:s}})),E=new st;return{set:c,get:p,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(p(),s),advance:(s,d)=>t(s,d,p()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new qt,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=p();f&&clearTimeout(f),s.performance.current!==s.performance.min&&h(s.performance.min),f=setTimeout(()=>h(p().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:s=>c(d=>({...d,events:{...d.events,...s}})),setSize:(s,d,y,x,C)=>{const S=p().camera,O={width:s,height:d,top:x||0,left:C||0,updateStyle:y};c(z=>({size:O,viewport:{...z.viewport,...u(S,n,O)}}))},setDpr:s=>c(d=>{const y=pt(s);return{viewport:{...d.viewport,dpr:y,initialDpr:d.viewport.initialDpr||y}}}),setFrameloop:(s="always")=>{const d=p().clock;d.stop(),d.elapsedTime=0,s!=="never"&&(d.start(),d.elapsedTime=0),c(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:b.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,d,y)=>{const x=p().internal;return x.priority=x.priority+(d>0?1:0),x.subscribers.push({ref:s,priority:d,store:y}),x.subscribers=x.subscribers.sort((C,S)=>C.priority-S.priority),()=>{const C=p().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(d>0?1:0),C.subscribers=C.subscribers.filter(S=>S.ref!==s))}}}}}),i=r.getState();let a=i.size,l=i.viewport.dpr,g=i.camera;return r.subscribe(()=>{const{camera:c,size:p,viewport:m,gl:n,set:o}=r.getState();if(p.width!==a.width||p.height!==a.height||m.dpr!==l){var u;a=p,l=m.dpr,mn(c,p),n.setPixelRatio(m.dpr);const f=(u=p.updateStyle)!=null?u:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(p.width,p.height,f)}c!==g&&(g=c,o(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(c)}})))}),r.subscribe(c=>e(c)),r};let ve,bn=new Set,En=new Set,Sn=new Set;function Me(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function ae(e,t){switch(e){case"before":return Me(bn,t);case"after":return Me(En,t);case"tail":return Me(Sn,t)}}let Oe,Re;function je(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Oe=t.internal.subscribers,ve=0;ve<Oe.length;ve++)Re=Oe[ve],Re.ref.current(Re.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function xn(e){let t=!1,r=!1,i,a,l;function g(m){a=requestAnimationFrame(g),t=!0,i=0,ae("before",m),r=!0;for(const o of e.values()){var n;l=o.store.getState(),l.internal.active&&(l.frameloop==="always"||l.internal.frames>0)&&!((n=l.gl.xr)!=null&&n.isPresenting)&&(i+=je(m,l))}if(r=!1,ae("after",m),i===0)return ae("tail",m),t=!1,cancelAnimationFrame(a)}function c(m,n=1){var o;if(!m)return e.forEach(u=>c(u.store.getState(),n));(o=m.gl.xr)!=null&&o.isPresenting||!m.internal.active||m.frameloop==="never"||(n>1?m.internal.frames=Math.min(60,m.internal.frames+n):r?m.internal.frames=2:m.internal.frames=1,t||(t=!0,requestAnimationFrame(g)))}function p(m,n=!0,o,u){if(n&&ae("before",m),o)je(m,o,u);else for(const f of e.values())je(m,f.store.getState());n&&ae("after",m)}return{loop:g,invalidate:c,advance:p}}function yt(){const e=b.useContext(gt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function re(e=r=>r,t){return yt()(e,t)}function wt(e,t=0){const r=yt(),i=r.getState().internal.subscribe,a=ut(e);return ue(()=>i(a,t,r),[t,i,r]),null}const et=new WeakMap;function bt(e,t){return function(r,...i){let a=et.get(r);return a||(a=new r,et.set(r,a)),e&&e(a),Promise.all(i.map(l=>new Promise((g,c)=>a.load(l,p=>{p.scene&&Object.assign(p,pn(p.scene)),g(p)},t,p=>c(new Error(`Could not load ${l}: ${p==null?void 0:p.message}`))))))}}function fe(e,t,r,i){const a=Array.isArray(t)?t:[t],l=on(bt(r,i),[e,...a],{equal:L.equ});return Array.isArray(t)?l:l[0]}fe.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return sn(bt(r),[e,...i])};fe.clear=function(e,t){const r=Array.isArray(t)?t:[t];return an([e,...r])};const oe=new Map,{invalidate:tt,advance:nt}=xn(oe),{reconciler:we,applyProps:Q}=ln(oe,vn),ee={objects:"shallow",strict:!1},Cn=(e,t)=>{const r=typeof e=="function"?e(t):e;return vt(r)?r:new Bt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Pn(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:a,top:l,left:g,updateStyle:c=r}=t;return{width:i,height:a,top:l,left:g,updateStyle:c}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:a,top:l,left:g}=e.parentElement.getBoundingClientRect();return{width:i,height:a,top:l,left:g,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function _n(e){const t=oe.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,l=i||wn(tt,nt),g=r||we.createContainer(l,le.ConcurrentRoot,null,!1,null,"",a,null);t||oe.set(e,{fiber:g,store:l});let c,p=!1,m;return{configure(n={}){let{gl:o,size:u,scene:f,events:h,onCreated:E,shadows:v=!1,linear:s=!1,flat:d=!1,legacy:y=!1,orthographic:x=!1,frameloop:C="always",dpr:S=[1,2],performance:O,raycaster:z,camera:P,onPointerMissed:_}=n,w=l.getState(),R=w.gl;w.gl||w.set({gl:R=Cn(o,e)});let H=w.raycaster;H||w.set({raycaster:H=new Dt});const{params:X,...k}=z||{};if(L.equ(k,H,ee)||Q(H,{...k}),L.equ(X,H.params,ee)||Q(H,{params:{...H.params,...X}}),!w.camera||w.camera===m&&!L.equ(m,P,ee)){m=P;const j=P instanceof Wt,T=j?P:x?new ke(0,0,0,0,.1,1e3):new De(75,0,.1,1e3);j||(T.position.z=5,P&&(Q(T,P),("aspect"in P||"left"in P||"right"in P||"bottom"in P||"top"in P)&&(T.manual=!0,T.updateProjectionMatrix())),!w.camera&&!(P!=null&&P.rotation)&&T.lookAt(0,0,0)),w.set({camera:T}),H.camera=T}if(!w.scene){let j;f!=null&&f.isScene?j=f:(j=new Ft,f&&Q(j,f)),w.set({scene:te(j)})}if(!w.xr){var N;const j=(M,V)=>{const G=l.getState();G.frameloop!=="never"&&nt(M,!0,G,V)},T=()=>{const M=l.getState();M.gl.xr.enabled=M.gl.xr.isPresenting,M.gl.xr.setAnimationLoop(M.gl.xr.isPresenting?j:null),M.gl.xr.isPresenting||tt(M)},F={connect(){const M=l.getState().gl;M.xr.addEventListener("sessionstart",T),M.xr.addEventListener("sessionend",T)},disconnect(){const M=l.getState().gl;M.xr.removeEventListener("sessionstart",T),M.xr.removeEventListener("sessionend",T)}};typeof((N=R.xr)==null?void 0:N.addEventListener)=="function"&&F.connect(),w.set({xr:F})}if(R.shadowMap){const j=R.shadowMap.enabled,T=R.shadowMap.type;if(R.shadowMap.enabled=!!v,L.boo(v))R.shadowMap.type=Se;else if(L.str(v)){var D;const F={basic:$t,percentage:Nt,soft:Se,variance:Gt};R.shadowMap.type=(D=F[v])!=null?D:Se}else L.obj(v)&&Object.assign(R.shadowMap,v);(j!==R.shadowMap.enabled||T!==R.shadowMap.type)&&(R.shadowMap.needsUpdate=!0)}const I=ct();I&&("enabled"in I?I.enabled=!y:"legacyMode"in I&&(I.legacyMode=y)),p||Q(R,{outputEncoding:s?3e3:3001,toneMapping:d?Ht:It}),w.legacy!==y&&w.set(()=>({legacy:y})),w.linear!==s&&w.set(()=>({linear:s})),w.flat!==d&&w.set(()=>({flat:d})),o&&!L.fun(o)&&!vt(o)&&!L.equ(o,R,ee)&&Q(R,o),h&&!w.events.handlers&&w.set({events:h(l)});const B=Pn(e,u);return L.equ(B,w.size,ee)||w.setSize(B.width,B.height,B.updateStyle,B.top,B.left),S&&w.viewport.dpr!==pt(S)&&w.setDpr(S),w.frameloop!==C&&w.setFrameloop(C),w.onPointerMissed||w.set({onPointerMissed:_}),O&&!L.equ(O,w.performance,ee)&&w.set(j=>({performance:{...j.performance,...O}})),c=E,p=!0,this},render(n){return p||this.configure(),we.updateContainer($.jsx(Mn,{store:l,children:n,onCreated:c,rootElement:e}),g,null,()=>{}),l},unmount(){Et(e)}}}function Mn({store:e,children:t,onCreated:r,rootElement:i}){return ue(()=>{const a=e.getState();a.set(l=>({internal:{...l.internal,active:!0}})),r&&r(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),$.jsx(gt.Provider,{value:e,children:t})}function Et(e,t){const r=oe.get(e),i=r==null?void 0:r.fiber;if(i){const a=r==null?void 0:r.store.getState();a&&(a.internal.active=!1),we.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var l,g,c,p;a.events.disconnect==null||a.events.disconnect(),(l=a.gl)==null||(g=l.renderLists)==null||g.dispose==null||g.dispose(),(c=a.gl)==null||c.forceContextLoss==null||c.forceContextLoss(),(p=a.gl)!=null&&p.xr&&a.xr.disconnect(),hn(a),oe.delete(e)}catch{}},500)})}}we.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:b.version});const Te={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function On(e){const{handlePointer:t}=yn(e);return{priority:1,enabled:!0,compute(r,i,a){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Te).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:a}=e.getState();(r=a.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:r=>{var i;const{set:a,events:l}=e.getState();l.disconnect==null||l.disconnect(),a(g=>({events:{...g.events,connected:r}})),Object.entries((i=l.handlers)!=null?i:[]).forEach(([g,c])=>{const[p,m]=Te[g];r.addEventListener(p,c,{passive:m})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([l,g])=>{if(i&&i.connected instanceof HTMLElement){const[c]=Te[l];i.connected.removeEventListener(c,g)}}),r(l=>({events:{...l.events,connected:void 0}}))}}}}function Rn({debounce:e,scroll:t,polyfill:r,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const a=r||typeof window<"u"&&window.ResizeObserver,[l,g]=b.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!a)return l.width=1280,l.height=800,[()=>{},l,()=>{}];const c=b.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:l,orientationHandler:null}),p=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,n=b.useRef(!1);b.useEffect(()=>(n.current=!0,()=>void(n.current=!1)));const[o,u,f]=b.useMemo(()=>{const s=()=>{if(!c.current.element)return;const{left:d,top:y,width:x,height:C,bottom:S,right:O,x:z,y:P}=c.current.element.getBoundingClientRect(),_={left:d,top:y,width:x,height:C,bottom:S,right:O,x:z,y:P};c.current.element instanceof HTMLElement&&i&&(_.height=c.current.element.offsetHeight,_.width=c.current.element.offsetWidth),Object.freeze(_),n.current&&!zn(c.current.lastBounds,_)&&g(c.current.lastBounds=_)};return[s,m?Ue(s,m):s,p?Ue(s,p):s]},[g,i,p,m]);function h(){c.current.scrollContainers&&(c.current.scrollContainers.forEach(s=>s.removeEventListener("scroll",f,!0)),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null),c.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",c.current.orientationHandler))}function E(){var s;c.current.element&&(c.current.resizeObserver=new a(u),(s=c.current.resizeObserver)==null||s.observe(c.current.element),t&&c.current.scrollContainers&&c.current.scrollContainers.forEach(d=>d.addEventListener("scroll",f,{capture:!0,passive:!0})),c.current.orientationHandler=()=>{f()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",c.current.orientationHandler))}const v=s=>{!s||s===c.current.element||(h(),c.current.element=s,c.current.scrollContainers=St(s),E())};return Tn(f,!!t),jn(u),b.useEffect(()=>{h(),E()},[t,f,u]),b.useEffect(()=>h,[]),[v,l,o]}function jn(e){b.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Tn(e,t){b.useEffect(()=>{if(t){const r=e;return window.addEventListener("scroll",r,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",r,!0)}},[e,t])}function St(e){const t=[];if(!e||e===document.body)return t;const{overflow:r,overflowX:i,overflowY:a}=window.getComputedStyle(e);return[r,i,a].some(l=>l==="auto"||l==="scroll")&&t.push(e),[...t,...St(e.parentElement)]}const Ln=["x","y","top","bottom","left","right","width","height"],zn=(e,t)=>Ln.every(r=>e[r]===t[r]),An=b.forwardRef(function({children:t,fallback:r,resize:i,style:a,gl:l,events:g=On,eventSource:c,eventPrefix:p,shadows:m,linear:n,flat:o,legacy:u,orthographic:f,frameloop:h,dpr:E,performance:v,raycaster:s,camera:d,scene:y,onPointerMissed:x,onCreated:C,...S},O){b.useMemo(()=>cn(Vt),[]);const z=Qt(),[P,_]=Rn({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=b.useRef(null),R=b.useRef(null);b.useImperativeHandle(O,()=>w.current);const H=ut(x),[X,k]=b.useState(!1),[N,D]=b.useState(!1);if(X)throw X;if(N)throw N;const I=b.useRef(null);ue(()=>{const j=w.current;_.width>0&&_.height>0&&j&&(I.current||(I.current=_n(j)),I.current.configure({gl:l,events:g,shadows:m,linear:n,flat:o,legacy:u,orthographic:f,frameloop:h,dpr:E,performance:v,raycaster:s,camera:d,scene:y,size:_,onPointerMissed:(...T)=>H.current==null?void 0:H.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(c?un(c)?c.current:c:R.current),p&&T.setEvents({compute:(F,M)=>{const V=F[p+"X"],G=F[p+"Y"];M.pointer.set(V/M.size.width*2-1,-(G/M.size.height)*2+1),M.raycaster.setFromCamera(M.pointer,M.camera)}}),C==null||C(T)}}),I.current.render($.jsx(z,{children:$.jsx(ft,{set:D,children:$.jsx(b.Suspense,{fallback:$.jsx(fn,{set:k}),children:t})})})))}),b.useEffect(()=>{const j=w.current;if(j)return()=>Et(j)},[]);const B=c?"none":"auto";return $.jsx("div",{ref:R,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:B,...a},...S,children:$.jsx("div",{ref:P,style:{width:"100%",height:"100%"},children:$.jsx("canvas",{ref:w,style:{display:"block"},children:r})})})}),cr=b.forwardRef(function(t,r){return $.jsx(Jt,{children:$.jsx(An,{...t,ref:r})})}),de=new U,Ie=new U,kn=new U,rt=new st;function Dn(e,t,r){const i=de.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=r.width/2,l=r.height/2;return[i.x*a+a,-(i.y*l)+l]}function Fn(e,t){const r=de.setFromMatrixPosition(e.matrixWorld),i=Ie.setFromMatrixPosition(t.matrixWorld),a=r.sub(i),l=t.getWorldDirection(kn);return a.angleTo(l)>Math.PI/2}function Hn(e,t,r,i){const a=de.setFromMatrixPosition(e.matrixWorld),l=a.clone();l.project(t),rt.set(l.x,l.y),r.setFromCamera(rt,t);const g=r.intersectObjects(i,!0);if(g.length){const c=g[0].distance;return a.distanceTo(r.ray.origin)<c}return!0}function In(e,t){if(t instanceof ke)return t.zoom;if(t instanceof De){const r=de.setFromMatrixPosition(e.matrixWorld),i=Ie.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,l=r.distanceTo(i);return 1/(2*Math.tan(a/2)*l)}else return 1}function Bn(e,t,r){if(t instanceof De||t instanceof ke){const i=de.setFromMatrixPosition(e.matrixWorld),a=Ie.setFromMatrixPosition(t.matrixWorld),l=i.distanceTo(a),g=(r[1]-r[0])/(t.far-t.near),c=r[1]-g*t.far;return Math.round(g*l+c)}}const Ae=e=>Math.abs(e)<1e-10?0:e;function xt(e,t,r=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=Ae(t[a]*e.elements[a])+(a!==15?",":")");return r+i}const Wn=(e=>t=>xt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),$n=(e=>(t,r)=>xt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Nn(e){return e&&typeof e=="object"&&"current"in e}const lr=b.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:a,center:l,fullscreen:g,portal:c,distanceFactor:p,sprite:m=!1,transform:n=!1,occlude:o,onOcclude:u,castShadow:f,receiveShadow:h,material:E,geometry:v,zIndexRange:s=[16777271,0],calculatePosition:d=Dn,as:y="div",wrapperClass:x,pointerEvents:C="auto",...S},O)=>{const{gl:z,camera:P,scene:_,size:w,raycaster:R,events:H,viewport:X}=re(),[k]=b.useState(()=>document.createElement(y)),N=b.useRef(),D=b.useRef(null),I=b.useRef(0),B=b.useRef([0,0]),j=b.useRef(null),T=b.useRef(null),F=(c==null?void 0:c.current)||H.connected||z.domElement.parentNode,M=b.useRef(null),V=b.useRef(!1),G=b.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Nn(o[0]),[o]);b.useLayoutEffect(()=>{const W=z.domElement;o&&o==="blending"?(W.style.zIndex=`${Math.floor(s[0]/2)}`,W.style.position="absolute",W.style.pointerEvents="none"):(W.style.zIndex=null,W.style.position=null,W.style.pointerEvents=null)},[o]),b.useLayoutEffect(()=>{if(D.current){const W=N.current=tn.createRoot(k);if(_.updateMatrixWorld(),n)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const A=d(D.current,P,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${A[0]}px,${A[1]}px,0);transform-origin:0 0;`}return F&&(a?F.prepend(k):F.appendChild(k)),()=>{F&&F.removeChild(k),W.unmount()}}},[F,n]),b.useLayoutEffect(()=>{x&&(k.className=x)},[x]);const We=b.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:l?"translate3d(-50%,-50%,0)":"none",...g&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,l,g,w,n]),_t=b.useMemo(()=>({position:"absolute",pointerEvents:C}),[C]);b.useLayoutEffect(()=>{if(V.current=!1,n){var W;(W=N.current)==null||W.render(b.createElement("div",{ref:j,style:We},b.createElement("div",{ref:T,style:_t},b.createElement("div",{ref:O,className:i,style:r,children:e}))))}else{var A;(A=N.current)==null||A.render(b.createElement("div",{ref:O,style:We,className:i,children:e}))}});const J=b.useRef(!0);wt(W=>{if(D.current){P.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const A=n?B.current:d(D.current,P,w);if(n||Math.abs(I.current-P.zoom)>t||Math.abs(B.current[0]-A[0])>t||Math.abs(B.current[1]-A[1])>t){const Y=Fn(D.current,P);let q=!1;G&&(Array.isArray(o)?q=o.map(Z=>Z.current):o!=="blending"&&(q=[_]));const ie=J.current;if(q){const Z=Hn(D.current,P,R,q);J.current=Z&&!Y}else J.current=!Y;ie!==J.current&&(u?u(!J.current):k.style.display=J.current?"block":"none");const pe=Math.floor(s[0]/2),Mt=o?G?[s[0],pe]:[pe-1,0]:s;if(k.style.zIndex=`${Bn(D.current,P,Mt)}`,n){const[Z,Ne]=[w.width/2,w.height/2],be=P.projectionMatrix.elements[5]*Ne,{isOrthographicCamera:Ge,top:Ot,left:Rt,bottom:jt,right:Tt}=P,Lt=Wn(P.matrixWorldInverse),zt=Ge?`scale(${be})translate(${Ae(-(Tt+Rt)/2)}px,${Ae((Ot+jt)/2)}px)`:`translateZ(${be}px)`;let K=D.current.matrixWorld;m&&(K=P.matrixWorldInverse.clone().transpose().copyPosition(K).scale(D.current.scale),K.elements[3]=K.elements[7]=K.elements[11]=0,K.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Ge?"":`${be}px`,j.current&&T.current&&(j.current.style.transform=`${zt}${Lt}translate(${Z}px,${Ne}px)`,T.current.style.transform=$n(K,1/((p||10)/400)))}else{const Z=p===void 0?1:In(D.current,P)*p;k.style.transform=`translate3d(${A[0]}px,${A[1]}px,0) scale(${Z})`}B.current=A,I.current=P.zoom}}if(!G&&M.current&&!V.current)if(n){if(j.current){const A=j.current.children[0];if(A!=null&&A.clientWidth&&A!=null&&A.clientHeight){const{isOrthographicCamera:Y}=P;if(Y||v)S.scale&&(Array.isArray(S.scale)?S.scale instanceof U?M.current.scale.copy(S.scale.clone().divideScalar(1)):M.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):M.current.scale.setScalar(1/S.scale));else{const q=(p||10)/400,ie=A.clientWidth*q,pe=A.clientHeight*q;M.current.scale.set(ie,pe,1)}V.current=!0}}}else{const A=k.children[0];if(A!=null&&A.clientWidth&&A!=null&&A.clientHeight){const Y=1/X.factor,q=A.clientWidth*Y,ie=A.clientHeight*Y;M.current.scale.set(q,ie,1),V.current=!0}M.current.lookAt(W.camera.position)}});const $e=b.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return b.createElement("group",at({},S,{ref:D}),o&&!G&&b.createElement("mesh",{castShadow:f,receiveShadow:h,ref:M},v||b.createElement("planeGeometry",null),E||b.createElement("shaderMaterial",{side:Ut,vertexShader:$e.vertexShader,fragmentShader:$e.fragmentShader})))}),ot=e=>{let t;const r=new Set,i=(m,n)=>{const o=typeof m=="function"?m(t):m;if(!Object.is(o,t)){const u=t;t=n??(typeof o!="object"||o===null)?o:Object.assign({},t,o),r.forEach(f=>f(t,u))}},a=()=>t,c={setState:i,getState:a,getInitialState:()=>p,subscribe:m=>(r.add(m),()=>r.delete(m))},p=t=e(i,a,c);return c},Gn=e=>e?ot(e):ot,qn=e=>e;function Vn(e,t=qn){const r=qe.useSyncExternalStore(e.subscribe,()=>t(e.getState()),()=>t(e.getInitialState()));return qe.useDebugValue(r),r}const it=e=>{const t=Gn(e),r=i=>Vn(t,i);return Object.assign(r,t),r},Un=e=>e?it(e):it;let ce=0;const ur=Un(e=>(he.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-ce)/(i-ce)*100})},he.onLoad=()=>{e({active:!1})},he.onError=t=>e(r=>({errors:[...r.errors,t]})),he.onProgress=(t,r,i)=>{r===i&&(ce=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-ce)/(i-ce)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));let ge=null,Ct="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Pt(e=!0,t=!0,r){return i=>{r&&r(i),e&&(ge||(ge=new nn),ge.setDecoderPath(typeof e=="string"?e:Ct),i.setDRACOLoader(ge)),t&&i.setMeshoptDecoder(typeof xe=="function"?xe():xe)}}const Be=(e,t,r,i)=>fe(Fe,e,Pt(t,r,i));Be.preload=(e,t,r,i)=>fe.preload(Fe,e,Pt(t,r,i));Be.clear=e=>fe.clear(Fe,e);Be.setDecoderPath=e=>{Ct=e};function Xn(e,t,r){const i=re(u=>u.size),a=re(u=>u.viewport),l=typeof e=="number"?e:i.width*a.dpr,g=i.height*a.dpr,c=(typeof e=="number"?r:e)||{},{samples:p=0,depth:m,...n}=c,o=b.useMemo(()=>{const u=new Xt(l,g,{minFilter:Ve,magFilter:Ve,type:Yt,...n});return m&&(u.depthTexture=new Zt(l,g,Kt)),u.samples=p,u},[]);return b.useLayoutEffect(()=>{o.setSize(l,g),p&&(o.samples=p)},[p,o,l,g]),b.useEffect(()=>()=>o.dispose(),[]),o}const Yn=e=>typeof e=="function",fr=b.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,makeDefault:i,children:a,...l},g)=>{const c=re(({set:v})=>v),p=re(({camera:v})=>v),m=re(({size:v})=>v),n=b.useRef(null);b.useImperativeHandle(g,()=>n.current,[]);const o=b.useRef(null),u=Xn(t);b.useLayoutEffect(()=>{l.manual||(n.current.aspect=m.width/m.height)},[m,l]),b.useLayoutEffect(()=>{n.current.updateProjectionMatrix()});let f=0,h=null;const E=Yn(a);return wt(v=>{E&&(r===1/0||f<r)&&(o.current.visible=!1,v.gl.setRenderTarget(u),h=v.scene.background,e&&(v.scene.background=e),v.gl.render(v.scene,n.current),v.scene.background=h,v.gl.setRenderTarget(null),o.current.visible=!0,f++)}),b.useLayoutEffect(()=>{if(i){const v=p;return c(()=>({camera:n.current})),()=>c(()=>({camera:v}))}},[n,i,c]),b.createElement(b.Fragment,null,b.createElement("perspectiveCamera",at({ref:n},l),!E&&a),b.createElement("group",{ref:o},E&&a(u.texture)))});export{cr as C,lr as H,fr as P,ur as a,wt as b,Be as u};
