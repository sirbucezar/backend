var p=function(t,e,r,i){this.name=t,this.fn=e,this.args=r,this.modifiers=i};p.prototype._test=function(t){var e=this.fn;try{a(this.modifiers.slice(),e,this)(t)}catch{e=function(){return!1}}try{return a(this.modifiers.slice(),e,this)(t)}catch{return!1}};p.prototype._check=function(t){try{a(this.modifiers.slice(),this.fn,this)(t)}catch{if(a(this.modifiers.slice(),function(r){return r},this)(!1))return}if(!a(this.modifiers.slice(),this.fn,this)(t))throw null};p.prototype._testAsync=function(t){var e=this;return new Promise(function(r,i){A(e.modifiers.slice(),e.fn,e)(t).then(function(u){u?r(t):i(null)}).catch(function(u){return i(u)})})};function w(n,t){return t===void 0&&(t="simple"),typeof n=="object"?n[t]:n}function a(n,t,e){if(n.length){var r=n.shift(),i=a(n,t,e);return r.perform(i,e)}else return w(t)}function A(n,t,e){if(n.length){var r=n.shift(),i=A(n,t,e);return r.performAsync(i,e)}else return function(u){return Promise.resolve(w(t,"async")(u))}}var M=function(t,e,r){this.name=t,this.perform=e,this.performAsync=r},_=function(n){function t(e,r,i,u){for(var o=[],f=arguments.length-4;f-- >0;)o[f]=arguments[f+4];n.call(this,o),n.captureStackTrace&&n.captureStackTrace(this,t),this.rule=e,this.value=r,this.cause=i,this.target=u}return n&&(t.__proto__=n),t.prototype=Object.create(n&&n.prototype),t.prototype.constructor=t,t}(Error),c=function(t,e){t===void 0&&(t=[]),e===void 0&&(e=[]),this.chain=t,this.nextRuleModifiers=e};c.prototype._applyRule=function(t,e){var r=this;return function(){for(var i=[],u=arguments.length;u--;)i[u]=arguments[u];return r.chain.push(new p(e,t.apply(r,i),i,r.nextRuleModifiers)),r.nextRuleModifiers=[],r}};c.prototype._applyModifier=function(t,e){return this.nextRuleModifiers.push(new M(e,t.simple,t.async)),this};c.prototype._clone=function(){return new c(this.chain.slice(),this.nextRuleModifiers.slice())};c.prototype.test=function(t){return this.chain.every(function(e){return e._test(t)})};c.prototype.testAll=function(t){var e=[];return this.chain.forEach(function(r){try{r._check(t)}catch(i){e.push(new _(r,t,i))}}),e};c.prototype.check=function(t){this.chain.forEach(function(e){try{e._check(t)}catch(r){throw new _(e,t,r)}})};c.prototype.testAsync=function(t){var e=this;return new Promise(function(r,i){R(t,e.chain.slice(),r,i)})};function R(n,t,e,r){if(t.length){var i=t.shift();i._testAsync(n).then(function(){R(n,t,e,r)},function(u){r(new _(i,n,u))})}else e(n)}var b=function(n,t){return t&&typeof n=="string"&&n.trim().length===0?!0:n==null};function v(n,t){return t===void 0&&(t=!1),{simple:function(e){return b(e,t)||n.check(e)===void 0},async:function(e){return b(e,t)||n.testAsync(e)}}}function O(){return typeof Proxy<"u"?k(new c):m(new c)}var h={};O.extend=function(n){Object.assign(h,n)};O.clearCustomRules=function(){h={}};function k(n){return new Proxy(n,{get:function(e,r){if(r in e)return e[r];var i=k(n._clone());if(r in y)return i._applyModifier(y[r],r);if(r in h)return i._applyRule(h[r],r);if(r in d)return i._applyRule(d[r],r)}})}function m(n){var t=function(i,u){return Object.keys(i).forEach(function(o){u[o]=function(){for(var f=[],g=arguments.length;g--;)f[g]=arguments[g];var j=m(u._clone()),P=j._applyRule(i[o],o).apply(void 0,f);return P}}),u},e=t(d,n),r=t(h,e);return Object.keys(y).forEach(function(i){Object.defineProperty(r,i,{get:function(){var u=m(r._clone());return u._applyModifier(y[i],i)}})}),r}var y={not:{simple:function(n){return function(t){return!n(t)}},async:function(n){return function(t){return Promise.resolve(n(t)).then(function(e){return!e}).catch(function(){return!0})}}},some:{simple:function(n){return function(t){return l(t).some(function(e){try{return n(e)}catch{return!1}})}},async:function(n){return function(t){return Promise.all(l(t).map(function(e){try{return n(e).catch(function(){return!1})}catch{return!1}})).then(function(e){return e.some(Boolean)})}}},every:{simple:function(n){return function(t){return t!==!1&&l(t).every(n)}},async:function(n){return function(t){return Promise.all(l(t).map(n)).then(function(e){return e.every(Boolean)})}}},strict:{simple:function(n,t){return function(e){return x(t)&&e&&typeof e=="object"?Object.keys(t.args[0]).length===Object.keys(e).length&&n(e):n(e)}},async:function(n,t){return function(e){return Promise.resolve(n(e)).then(function(r){return x(t)&&e&&typeof e=="object"?Object.keys(t.args[0]).length===Object.keys(e).length&&r:r}).catch(function(){return!1})}}}};function x(n){return n&&n.name==="schema"&&n.args.length>0&&typeof n.args[0]=="object"}function l(n){return typeof n=="string"?n.split(""):n}var d={equal:function(n){return function(t){return t==n}},exact:function(n){return function(t){return t===n}},number:function(n){return n===void 0&&(n=!0),function(t){return typeof t=="number"&&(n||isFinite(t))}},integer:function(){return function(n){var t=Number.isInteger||$;return t(n)}},numeric:function(){return function(n){return!isNaN(parseFloat(n))&&isFinite(n)}},string:function(){return s("string")},boolean:function(){return s("boolean")},undefined:function(){return s("undefined")},null:function(){return s("null")},array:function(){return s("array")},object:function(){return s("object")},instanceOf:function(n){return function(t){return t instanceof n}},pattern:function(n){return function(t){return n.test(t)}},lowercase:function(){return function(n){return typeof n=="boolean"||n===n.toLowerCase()&&n.trim()!==""}},uppercase:function(){return function(n){return n===n.toUpperCase()&&n.trim()!==""}},vowel:function(){return function(n){return/^[aeiou]+$/i.test(n)}},consonant:function(){return function(n){return/^(?=[^aeiou])([a-z]+)$/i.test(n)}},first:function(n){return function(t){return t[0]==n}},last:function(n){return function(t){return t[t.length-1]==n}},empty:function(){return function(n){return n.length===0}},length:function(n,t){return function(e){return e.length>=n&&e.length<=(t||n)}},minLength:function(n){return function(t){return t.length>=n}},maxLength:function(n){return function(t){return t.length<=n}},negative:function(){return function(n){return n<0}},positive:function(){return function(n){return n>=0}},between:function(n,t){return function(e){return e>=n&&e<=t}},range:function(n,t){return function(e){return e>=n&&e<=t}},lessThan:function(n){return function(t){return t<n}},lessThanOrEqual:function(n){return function(t){return t<=n}},greaterThan:function(n){return function(t){return t>n}},greaterThanOrEqual:function(n){return function(t){return t>=n}},even:function(){return function(n){return n%2===0}},odd:function(){return function(n){return n%2!==0}},includes:function(n){return function(t){return~t.indexOf(n)}},schema:function(n){return C(n)},passesAnyOf:function(){for(var n=[],t=arguments.length;t--;)n[t]=arguments[t];return function(e){return n.some(function(r){return r.test(e)})}},optional:v};function s(n){return function(t){return Array.isArray(t)&&n==="array"||t===null&&n==="null"||typeof t===n}}function $(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n}function C(n){return{simple:function(t){var e=[];if(Object.keys(n).forEach(function(r){var i=n[r];try{i.check((t||{})[r])}catch(u){u.target=r,e.push(u)}}),e.length>0)throw e;return!0},async:function(t){var e=[],r=Object.keys(n).map(function(i){var u=n[i];return u.testAsync((t||{})[i]).catch(function(o){o.target=i,e.push(o)})});return Promise.all(r).then(function(){if(e.length>0)throw e;return!0})}}}export{O as v};
